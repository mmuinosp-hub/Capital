<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consola Admin</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
#control, #jugadores { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
button { margin: 5px; }
</style>
</head>
<body>

<h1>Consola Admin</h1>

<div id="inicio">
  <button id="btnCrearSala">Crear Sala</button>
  <button id="btnEntrarSala">Entrar en Sala</button>
</div>

<div id="salaForm" style="display:none;">
  <h2 id="salaNombre"></h2>
</div>

<div id="control" style="display:none;">
  <h3>Control de Juego</h3>
  <button id="btnAbrirEntregas">Abrir/Cerrar Entregas</button>
  <span id="estadoEntregas"></span>
  <button id="btnAbrirProduccion">Abrir/Cerrar Producción</button>
  <span id="estadoProduccion"></span>
  <button id="btnNuevaSesion">Nueva Sesión</button>
</div>

<div id="jugadores" style="display:none;">
  <h3>Jugadores en la sala</h3>
  <ul id="listaJugadores"></ul>
</div>

<script>
const socket = io();
let salaActual = "";

// Crear/Entrar Sala
document.getElementById("btnCrearSala").onclick = () => {
  const sala = prompt("Nombre de la sala:");
  const pass = prompt("Password de la sala:");
  if (sala && pass) socket.emit("crearSala", { sala, password: pass });
};
document.getElementById("btnEntrarSala").onclick = () => {
  const sala = prompt("Nombre de la sala:");
  const pass = prompt("Password de la sala:");
  if (sala && pass) socket.emit("entrarAdmin", { sala, password: pass });
};

// Eventos socket
socket.on("salaCreada", sala => {
  salaActual = sala;
  document.getElementById("salaNombre").innerText = `Sala: ${sala}`;
  document.getElementById("salaForm").style.display = "block";
  socket.emit("entrarAdmin", { sala, password: prompt("Password de la sala:") });
});

socket.on("adminEntrado", sala => {
  salaActual = sala;
  document.getElementById("salaForm").style.display = "block";
  document.getElementById("control").style.display = "block";
  document.getElementById("jugadores").style.display = "block";
});

socket.on("actualizarEstado", data => {
  // Estado de entregas y producción
  document.getElementById("estadoEntregas").innerText = data.entregasAbiertas ? "Abiertas" : "Cerradas";
  document.getElementById("estadoProduccion").innerText = data.produccionAbierta ? "Abiertas" : "Cerradas";

  // Lista de jugadores
  const ul = document.getElementById("listaJugadores");
  ul.innerHTML = "";
  for (const n in data.jugadores) {
    const li = document.createElement("li");
    const j = data.jugadores[n];
    li.textContent = `${n} - Trigo: ${j.trigo}, Hierro: ${j.hierro}, Entregas: ${j.entregas}`;
    ul.appendChild(li);
  }
});

// Botones de control
document.getElementById("btnAbrirEntregas").onclick = () => socket.emit("toggleEntregas", salaActual);
document.getElementById("btnAbrirProduccion").onclick = () => socket.emit("toggleProduccion", salaActual);
document.getElementById("btnNuevaSesion").onclick = () => socket.emit("nuevaSesion", salaActual);
</script>
</body>
</html>
