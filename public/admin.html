<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Administrador - Capitalismo Simulado</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { font-family: Arial; margin: 30px; }
  table { border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #aaa; padding: 4px 8px; text-align: center; }
  button { margin: 4px; padding: 6px 12px; }
</style>
</head>
<body>
<h2>Administrador</h2>
<label>Sala: <input id="sala" /></label>
<button id="crearSalaBtn">Entrar / Crear Sala</button>

<h3>Jugadores</h3>
<label>Nombre: <input id="jugador" /></label>
<label>Contraseña: <input id="password" type="password" /></label>
<button id="crearJugadorBtn">Agregar jugador</button>

<table id="tablaJugadores">
  <thead>
    <tr>
      <th>Jugador</th><th>Trigo</th><th>Hierro</th>
      <th>Entregas</th><th>Proceso</th>
      <th>Prod Trigo</th><th>Prod Hierro</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>Controles</h3>
<button id="abrirEntregas">Abrir entregas</button>
<button id="cerrarEntregasAbrirProduccion">Cerrar entregas / Abrir producción</button>
<button id="iniciarProduccion">Iniciar producción</button>

<h3>Historial de entregas</h3>
<table id="tablaHistorial">
  <thead>
    <tr><th>De</th><th>Para</th><th>Recurso</th><th>Cantidad</th><th>Hora</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const socket = io();
let salaActual = "";

document.getElementById("crearSalaBtn").onclick = () => {
  salaActual = document.getElementById("sala").value.trim();
  if (!salaActual) return alert("Introduce una sala");
  socket.emit("crearSala", { sala: salaActual });
};

document.getElementById("crearJugadorBtn").onclick = () => {
  const jugador = document.getElementById("jugador").value.trim();
  const password = document.getElementById("password").value.trim();
  if (!jugador || !password) return alert("Faltan datos");
  socket.emit("crearJugador", { sala: salaActual, jugador, password });
};

socket.on("jugadoresActualizados", (jugadores) => {
  const tbody = document.querySelector("#tablaJugadores tbody");
  tbody.innerHTML = "";
  for (const [nombre, j] of Object.entries(jugadores)) {
    const fila = `<tr>
      <td>${nombre}</td>
      <td>${j.trigo.toFixed(2)}</td>
      <td>${j.hierro.toFixed(2)}</td>
      <td>${j.entregas}</td>
      <td>${j.proceso ?? "-"}</td>
      <td>${j.prodTrigo.toFixed(2)}</td>
      <td>${j.prodHierro.toFixed(2)}</td>
    </tr>`;
    tbody.innerHTML += fila;
  }
});

socket.on("historialActualizado", (historial) => {
  const tbody = document.querySelector("#tablaHistorial tbody");
  tbody.innerHTML = "";
  for (const e of historial) {
    tbody.innerHTML += `<tr><td>${e.origen}</td><td>${e.destino}</td><td>${e.recurso}</td><td>${e.cantidad}</td><td>${e.hora}</td></tr>`;
  }
});

document.getElementById("abrirEntregas").onclick = () => socket.emit("abrirEntregas", salaActual);
document.getElementById("cerrarEntregasAbrirProduccion").onclick = () => socket.emit("cerrarEntregasAbrirProduccion", salaActual);
document.getElementById("iniciarProduccion").onclick = () => socket.emit("iniciarProduccion", salaActual);
</script>
</body>
</html>
