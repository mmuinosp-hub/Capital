<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consola Administrador</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { font-family: sans-serif; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #aaa; padding: 5px; text-align: center; }
  input, button { margin: 5px; }
</style>
</head>
<body>
<h1>Consola Administrador</h1>

<div>
  <label>Sala: <input id="roomId" /></label>
  <label>Contrase침a: <input type="password" id="password" /></label>
  <button id="loginBtn">Entrar</button>
</div>

<div id="controls" style="display:none;">
  <h2>Jugadores</h2>
  <table id="jugadoresTabla">
    <thead>
      <tr>
        <th>Jugador</th>
        <th>Trigo</th>
        <th>Hierro</th>
        <th>Entregas</th>
        <th>Proceso</th>
        <th>Prod Trigo</th>
        <th>Prod Hierro</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Crear Jugador</h3>
  <label>Nombre: <input id="nombreJugador" /></label>
  <label>Contrase침a: <input id="passwordJugador" /></label>
  <label>Trigo: <input id="trigoJugador" /></label>
  <label>Hierro: <input id="hierroJugador" /></label>
  <button id="crearBtn">Crear</button>

  <h3>Control de Juego</h3>
  <button id="abrirEntregasBtn">Abrir Entregas</button>
  <button id="abrirProduccionBtn">Abrir Producci칩n</button>
  <button id="concluirProduccionBtn">Concluir Producci칩n</button>

  <h3>Historial de Entregas</h3>
  <table id="historialTabla">
    <thead>
      <tr>
        <th>De</th>
        <th>Para</th>
        <th>Trigo</th>
        <th>Hierro</th>
        <th>Hora</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const socket = io();
let roomId;

document.getElementById("loginBtn").onclick = () => {
  roomId = document.getElementById("roomId").value;
  const password = document.getElementById("password").value;
  socket.emit("loginAdmin", { roomId, password }, res => {
    if(res.success) document.getElementById("controls").style.display = "block";
    else alert(res.message);
  });
};

document.getElementById("crearBtn").onclick = () => {
  const nombre = document.getElementById("nombreJugador").value;
  const password = document.getElementById("passwordJugador").value;
  const trigo = parseFloat(document.getElementById("trigoJugador").value) || 0;
  const hierro = parseFloat(document.getElementById("hierroJugador").value) || 0;
  socket.emit("crearJugador", { roomId, nombre, password, trigo, hierro }, res => {
    if(!res.success) alert(res.message);
  });
};

document.getElementById("abrirEntregasBtn").onclick = () => {
  socket.emit("setFase", { roomId, fase:"entregas" });
};
document.getElementById("abrirProduccionBtn").onclick = () => {
  socket.emit("setFase", { roomId, fase:"produccion" });
};
document.getElementById("concluirProduccionBtn").onclick = () => {
  socket.emit("concluirProduccion", { roomId });
};

socket.on("updatePlayers", jugadores => {
  const tbody = document.getElementById("jugadoresTabla").querySelector("tbody");
  tbody.innerHTML = "";
  for(let nombre in jugadores){
    const j = jugadores[nombre];
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${nombre}</td><td>${j.trigo}</td><td>${j.hierro}</td><td>${j.entregas}</td>
                    <td>${j.proceso || ""}</td><td>${j.trigoProd}</td><td>${j.hierroProd}</td>`;
    tbody.appendChild(tr);
  }
});

socket.on("updateHistorial", historial => {
  const tbody = document.getElementById("historialTabla").querySelector("tbody");
  tbody.innerHTML = "";
  historial.forEach(entrega => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${entrega.from}</td><td>${entrega.to}</td>
                    <td>${entrega.trigo}</td><td>${entrega.hierro}</td>
                    <td>${entrega.timestamp}</td>`;
    tbody.appendChild(tr);
  });
});
</script>
</body>
</html>
