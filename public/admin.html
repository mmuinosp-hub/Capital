<!--
© 2025 Manuel Muiños
Licencia: Creative Commons Atribución-NoComercial-SinDerivadas 4.0 Internacional (CC BY-NC-ND 4.0)
https://creativecommons.org/licenses/by-nc-nd/4.0/
-->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Capital - Panel de Control</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    h1 { background: #222; color: #fff; margin: 0; padding: 10px; text-align: center; }
    .container { padding: 20px; max-width: 900px; margin: auto; }
    button { margin: 5px; padding: 8px 14px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    td, th { border: 1px solid #ccc; padding: 5px; text-align: center; }
    th { background: #ddd; }
    .top-bar { display: flex; justify-content: space-between; align-items: center; }
    a.inicio-link { text-decoration: none; color: #007bff; margin-left: 10px; }
    a.inicio-link:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>Capital - Panel de Control</h1>
  <div class="container" id="login">
    <h3>Ingresar al panel</h3>
    <form id="loginForm">
      <label>Nombre del administrador:</label><br>
      <input type="text" id="nombre" required><br><br>
      <label>Sala:</label><br>
      <input type="text" id="sala" required><br><br>
      <label>Contraseña:</label><br>
      <input type="password" id="pass"><br><br>
      <button type="submit">Entrar</button>
      <a href="/" class="inicio-link">🏠 Volver al inicio</a>
    </form>
  </div>

  <div class="container" id="panel" style="display:none;">
    <div class="top-bar">
      <h2 id="tituloSala"></h2>
      <a href="/" class="inicio-link">🏠 Inicio</a>
    </div>

    <div>
      <button id="toggleEntregas">Abrir/Cerrar entregas</button>
      <button id="toggleProduccion">Abrir producción/Nueva sesión</button>
      <!-- Botón "Nueva sesión" eliminado -->
      <button id="guardarEstado">Guardar estado</button>
    </div>

    <h3>Jugadores</h3>
    <table id="tablaJugadores">
      <thead>
        <tr>
          <th>Jugador</th>
          <th>Trigo</th>
          <th>Hierro</th>
          <th>Pan</th>
          <th>Herramientas</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const socket = io();
    const loginDiv = document.getElementById('login');
    const panelDiv = document.getElementById('panel');
    const loginForm = document.getElementById('loginForm');
    const tituloSala = document.getElementById('tituloSala');
    const tablaJugadores = document.getElementById('tablaJugadores').querySelector('tbody');
    const toggleEntregasBtn = document.getElementById('toggleEntregas');
    const toggleProduccionBtn = document.getElementById('toggleProduccion');
    const guardarEstadoBtn = document.getElementById('guardarEstado');

    loginForm.addEventListener('submit', e => {
      e.preventDefault();
      socket.emit('login_admin', {
        nombre: document.getElementById('nombre').value,
        sala: document.getElementById('sala').value,
        pass: document.getElementById('pass').value
      });
    });

    socket.on('admin_ok', sala => {
      loginDiv.style.display = 'none';
      panelDiv.style.display = 'block';
      tituloSala.textContent = `Sala: ${sala}`;
    });

    socket.on('estado_actualizado', estado => {
      tablaJugadores.innerHTML = '';
      for (const [nombre, rec] of Object.entries(estado.jugadores)) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${nombre}</td>
          <td>${rec.trigo}</td>
          <td>${rec.hierro}</td>
          <td>${rec.pan}</td>
          <td>${rec.herramientas}</td>`;
        tablaJugadores.appendChild(tr);
      }
    });

    toggleEntregasBtn.onclick = () => socket.emit('toggle_entregas');
    toggleProduccionBtn.onclick = () => socket.emit('toggle_produccion');
    guardarEstadoBtn.onclick = () => socket.emit('guardar_estado');
  </script>
</body>
</html>

