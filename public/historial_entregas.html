<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Historial de Entregas</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
th, td { border: 1px solid #999; padding: 5px; text-align: center; }
h2, h3 { margin-top: 30px; }
</style>
</head>
<body>
<h1>Historial de Entregas</h1>
<label>Sala: <input id="sala" placeholder="Nombre de la sala"></label>
<button onclick="cargarEntregas()">Cargar historial</button>

<div id="contenedorEntregas"></div>

<script>
async function cargarEntregas() {
  const sala = document.getElementById("sala").value.trim();
  if (!sala) return alert("Introduce el nombre de la sala");

  const response = await fetch(`/listarEntregas?sala=${sala}`);
  const archivos = await response.json();

  const contenedor = document.getElementById("contenedorEntregas");
  contenedor.innerHTML = "";

  if (archivos.length === 0) {
    contenedor.innerHTML = "<p>No hay sesiones registradas para esta sala.</p>";
    return;
  }

  for (const archivo of archivos) {
    const dataResp = await fetch(`/historialArchivo?archivo=${archivo}`);
    const data = await dataResp.json();

    const fecha = archivo.split("_").pop().replace(".json", "");

    const h3 = document.createElement("h3");
    h3.textContent = `Sesi√≥n: ${fecha}`;
    contenedor.appendChild(h3);

    const tabla = document.createElement("table");
    const thead = document.createElement("thead");
    thead.innerHTML = "<tr><th>De</th><th>Para</th><th>Trigo</th><th>Hierro</th><th>Hora</th></tr>";
    tabla.appendChild(thead);

    const tbody = document.createElement("tbody");
    for (const h of data) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${h.de}</td><td>${h.para}</td><td>${h.trigo}</td><td>${h.hierro}</td><td>${h.hora}</td>`;
      tbody.appendChild(tr);
    }
    tabla.appendChild(tbody);
    contenedor.appendChild(tabla);
  }
}
</script>
</body>
</html>
