<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Historial de Entregas</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
fieldset { margin-bottom: 15px; }
</style>
</head>
<body>

<h1>Historial de Entregas</h1>

<p>
  Sala: <input type="text" id="sala" placeholder="Nombre de la sala">
  <button id="btnCargar">Cargar historial</button>
  <button id="btnCargarTodas">Cargar historial de todas las sesiones</button>
</p>

<div id="historial"></div>

<script>
const historialDiv = document.getElementById("historial");

function mostrarEntregas(data, fecha) {
  const div = document.createElement("div");
  div.style.border = "1px solid #ccc";
  div.style.marginBottom = "10px";
  div.style.padding = "10px";

  const h3 = document.createElement("h3");
  h3.innerText = `Sesión: ${fecha}`;
  div.appendChild(h3);

  data.forEach(e => {
    const p = document.createElement("p");
    p.innerText = `${e.hora} - ${e.de} → ${e.para}: Trigo=${e.trigo}, Hierro=${e.hierro}`;
    div.appendChild(p);
  });

  historialDiv.appendChild(div);
}

function cargarHistorial(todas=false) {
  historialDiv.innerHTML = "";
  const sala = document.getElementById("sala").value;
  fetch(`/listarEntregas?sala=${sala}`)
    .then(r => r.json())
    .then(archivos => {
      if (!todas) archivos = [archivos[archivos.length-1]]; // solo última sesión
      archivos.forEach(a => {
        fetch(`/historialArchivo?archivo=${a}`)
          .then(r => r.json())
          .then(data => mostrarEntregas(data, a));
      });
    });
}

document.getElementById("btnCargar").onclick = () => cargarHistorial(false);
document.getElementById("btnCargarTodas").onclick = () => cargarHistorial(true);
</script>

</body>
</html>
